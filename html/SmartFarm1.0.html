<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="generator" content="Google Web Designer 1.7.0.1114">
  <meta name="template" content="Banner 3.0.0">
  <meta name="environment" content="gwd-doubleclick">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="gwdpage_style.css" rel="stylesheet" data-version="8" data-exports-type="gwd-page">
  <link href="gwdpagedeck_style.css" rel="stylesheet" data-version="9" data-exports-type="gwd-pagedeck">
  <link href="gwddoubleclick_style.css" rel="stylesheet" data-version="14" data-exports-type="gwd-doubleclick">
  <link href="gwdimage_style.css" rel="stylesheet" data-version="9" data-exports-type="gwd-image">
  <link href="custom_style.css" rel="stylesheet" data-version="9" type="text/css">
  <script data-source="googbase_min.js" data-version="3" data-exports-type="googbase" src="googbase_min.js"></script>
  <script data-source="gwd_webcomponents_min.js" data-version="5" data-exports-type="gwd_webcomponents" src="gwd_webcomponents_min.js"></script>
  <script data-source="gwdpage_min.js" data-version="8" data-exports-type="gwd-page" src="gwdpage_min.js"></script>
  <script data-source="gwdpagedeck_min.js" data-version="9" data-exports-type="gwd-pagedeck" src="gwdpagedeck_min.js"></script>
  <script data-source="https://s0.2mdn.net/ads/studio/Enabler.js" data-exports-type="gwd-doubleclick" src="https://s0.2mdn.net/ads/studio/Enabler.js"></script>
  <script data-source="gwddoubleclick_min.js" data-version="14" data-exports-type="gwd-doubleclick" src="gwddoubleclick_min.js"></script>
  <script data-source="gwdimage_min.js" data-version="9" data-exports-type="gwd-image" src="gwdimage_min.js"></script>
  <script type="text/javascript" gwd-events="support" src="gwd-events-support.1.0.js"></script>
  <script type="text/javascript" src="/webiopi.js"></script>
  <script type="text/javascript">
		
		var onOffButtonArray = {buttonName:"OnOffButton", relayPort:20, onImage:"on_button-image", offImage:"off_button-image", autoImage:"auto_button-image"};
		var valveArray = [{valveName:"FontRightValve", motor1Port:12, motor2Port:16, switchPort:21, valveImage:"font_right_valve-image", waterImage:"font_right_water-image", executionOrder:4, isNewValve:false},
						  {valveName:"FontLeftValve", motor1Port:27, motor2Port:22, switchPort:21, valveImage:"font_left_valve-image", waterImage:"font_left_water-image", executionOrder:4, isNewValve:false},
						  {valveName:"MiddleRightValve", motor1Port:5, motor2Port:5, switchPort:21, valveImage:"middle_right_valve-image", waterImage:"middle_right_water-image", executionOrder:2, isNewValve:true},
						  {valveName:"MiddleLeftValve", motor1Port:6, motor2Port:13, switchPort:21, valveImage:"middle_left_valve-image", waterImage:"middle_left_water-image", executionOrder:4, isNewValve:false},
						  {valveName:"BackRightValve", motor1Port:19, motor2Port:26, switchPort:21, valveImage:"back_right_valve-image", waterImage:"back_right_water-image", executionOrder:3, isNewValve:false},
						  {valveName:"BackLeftValve", motor1Port:18, motor2Port:18, switchPort:21, valveImage:"back_left_valve-image", waterImage:"back_left_water-image", executionOrder:1, isNewValve:true},
						  {valveName:"BackMiddle1Valve", motor1Port:23, motor2Port:24, switchPort:21, valveImage:"back_middle1_valve-image", waterImage:"back_middle1_water-image", executionOrder:3, isNewValve:false}];
						  
        var sensorArray = [{sensorName:"FontRightSensor", analogPort:0}];
        
        var ultraSonicSensor = [{sensorName:"MixingTank", analogPort:1},
								{sensorName:"PumpingTank", analogPort:2}];

        webiopi().ready(function() {
				//Add valves
				var index;
				var valveLen = valveArray.length;
				for(index = 0; index < valveLen; index++)
				{
					webiopi().callMacro("AddValve", [valveArray[index].valveName, valveArray[index].motor1Port, valveArray[index].motor2Port, valveArray[index].switchPort, valveArray[index].executionOrder, valveArray[index].isNewValve] , null);
					webiopi().callMacro("GetValveState", valveArray[index].valveName, UpdateValveStateCallback);
				}
				
				webiopi().callMacro("IsAutoModeRunning", [], function(acro, args, data){
																							if(data)
																							{
																								gwd.actions.events.setInlineStyle(onOffButtonArray.autoImage, 'visibility: visible; ');
																								gwd.actions.events.setInlineStyle(onOffButtonArray.onImage, 'visibility: hidden; ');
																								gwd.actions.events.setInlineStyle(onOffButtonArray.offImage, 'visibility: hidden; ');	
																								UpdateAutoModeStatus();
																							}
																							else
																							{
																								//In case of running error
																								webiopi().callMacro("IsAutoModeError", [], function(acro, args, data)
																																			{
																																				if(data)
																																				{
																																					window.alert("Auto mode failed. The engine ran off. Please try again!");
																																				}
																																				else
																																				{
																																					webiopi().callMacro("IsMachineOpennig", [], function(macro, args, data)
																																																{
																																																	if(data)
																																																	{
																																																		gwd.actions.events.setInlineStyle(onOffButtonArray.autoImage, 'visibility: hidden; ');
																																																		gwd.actions.events.setInlineStyle(onOffButtonArray.onImage, 'visibility: visible; ');
																																																		gwd.actions.events.setInlineStyle(onOffButtonArray.offImage, 'visibility: hidden; ');
																																								
																																																		}
																																										});
																																				}
																																			});
	
																							}
																						});
				
				
				var ultrasonicLen = ultraSonicSensor.length
				for(index = 0; index < ultrasonicLen; index++)
				{
					webiopi().callMacro("AddUltrasonic", [ultraSonicSensor[index].sensorName, ultraSonicSensor[index].analogPort] , null);
				}	
				
				var sensorLen = sensorArray.length
				for(index = 0; index < sensorLen; index++)
				{
					webiopi().callMacro("AddSensor", [sensorArray[index].sensorName, sensorArray[index].analogPort] , null);
				}
				
				setInterval(UpdateSensor, 2000);	
				
				
				
                // Refresh GPIO buttons
                // pass true to refresh repeatedly of false to refresh once
                webiopi().refreshGPIO(true);
        });
        
        function UpdateValveStateCallback(macro, args, data)
		{
			UpdateValveState(args, data);
		}
		
        // function called through setInterval
		function UpdateSensor() 
		{
			var index;
			var sensorLen = sensorArray.length
			for(index = 0; index < sensorLen; index++)
			{
				webiopi().callMacro('GetSensorValue', sensorArray[index].sensorName, UpdateSensorCallback);
			}
		}    
		
		function UpdateSensorCallback(macro, args, data)
		{
			document.getElementById('Font-Sensor-Text').innerHTML = 'ชื้น:' + data;
		}
		
		function OpenValve(valveName)
		{
			window.alert("Open valve call");
			webiopi().callMacro("OpenValve", valveName, OpenValveCallback);
		}
		
		function CloseValve(valveName)
		{	
			window.alert("Close valve call");
			webiopi().callMacro("CloseValve", valveName, CloseValveCallback);											
			
		}
		
		function OpenValveCallback(macro, args, data)
		{
			if(data == 2)
			{
				window.alert("Open valve error!");
			}
			UpdateValveState(args,data);
			
			webiopi().callMacro("IsMachineOpennig", [], function(lMacro, lAargs, lData){
																							if(lData)
																							{
																								gwd.actions.events.setInlineStyle(onOffButtonArray.autoImage, 'visibility: hidden; ');
																								gwd.actions.events.setInlineStyle(onOffButtonArray.onImage, 'visibility: visible; ');
																								gwd.actions.events.setInlineStyle(onOffButtonArray.offImage, 'visibility: hidden; ');
																				
																							}
																						});
		}
		
		function CloseValveCallback(macro, args, data)
		{
			if(data == 2)
			{
				window.alert("Close valve error!");
			}
			UpdateValveState(args,data);
				
			webiopi().callMacro("IsMachineClosing", [], function(lMacro, lAargs, lData){
																							if(lData)
																							{
																								gwd.actions.events.setInlineStyle(onOffButtonArray.autoImage, 'visibility: hidden; ');
																								gwd.actions.events.setInlineStyle(onOffButtonArray.onImage, 'visibility: hidden; ');
																								gwd.actions.events.setInlineStyle(onOffButtonArray.offImage, 'visibility: visible; ');
																							
																							}
																						});			
		}
		
		function UpdateValveState(valveName, state)
		{
			
			var valveLength = valveArray.length;
			var index;
			
			for(index = 0; index < valveLength; index++)
			{
				if(valveArray[index].valveName == valveName)
				{	
					if(state == 1)
					{
						gwd.actions.events.setInlineStyle(valveArray[index].waterImage, 'visibility: visible; ');
						gwd.actions.events.setInlineStyle(valveArray[index].valveImage, 'visibility: hidden; ');
					}
					else
					{
						gwd.actions.events.setInlineStyle(valveArray[index].waterImage, 'visibility: hidden; ');
						gwd.actions.events.setInlineStyle(valveArray[index].valveImage, 'visibility: visible; ');
					}
					return;
				}
			}
		}

		function UpdateAutoModeStatus()
		{
							
			var UpdateAutoModeStatusHandle = setInterval(function(){
																	webiopi().callMacro("IsAutoModeRunning", 
																						[], 
																						function(acro, args, data){
																													if(data == false)
																													{
																														//Incase of running completed and running error
																														webiopi().callMacro("IsAutoModeError", 
																																								[], 
																																								function(acro, args, data){
																																									if(data)
																																									{
																																										window.alert("Auto mode failed. The engine ran off. Please try again!");
																																									}
																																									
																																								});
																														gwd.actions.events.setInlineStyle(onOffButtonArray.onImage, 'visibility: hidden; ');
																														gwd.actions.events.setInlineStyle(onOffButtonArray.autoImage, 'visibility: hidden; ');
																														gwd.actions.events.setInlineStyle(onOffButtonArray.offImage, 'visibility: visible; ');
																														clearInterval(UpdateAutoModeStatusHandle);
																													}
																
																													var index;
																													var valveLen = valveArray.length;
																													for(index = 0; index < valveLen; index++)
																													{
																														webiopi().callMacro("GetValveState", valveArray[index].valveName, UpdateValveStateCallback);
																													}
																																			
																													});
																	}, 3000);
		}
		
  </script>
        
  <script type="text/javascript" gwd-events="handlers">
	     
    window.gwd = window.gwd || {};
    
    gwd.OffImageClick = function(event) {	
		webiopi().callMacro("ExecutionAuto", [1200,1, onOffButtonArray.relayPort], null);
		gwd.actions.events.setInlineStyle(onOffButtonArray.autoImage, 'visibility: visible; ');
		gwd.actions.events.setInlineStyle(onOffButtonArray.onImage, 'visibility: hidden; ');
		gwd.actions.events.setInlineStyle(onOffButtonArray.offImage, 'visibility: hidden; ');																
		UpdateAutoModeStatus();
    };
    
    gwd.OnImageClick = function(event) {
		webiopi().callMacro('StopMachine', onOffButtonArray.relayPort, null);
		gwd.actions.events.setInlineStyle(onOffButtonArray.autoImage, 'visibility: hidden; ');
		gwd.actions.events.setInlineStyle(onOffButtonArray.onImage, 'visibility: hidden; ');
		gwd.actions.events.setInlineStyle(onOffButtonArray.offImage, 'visibility: visible; ');
    };
    
    gwd.AutoImageClick = function(event) {

    };
    
    gwd.FontRightValveOpenClick = function(event) {

		OpenValve(valveArray[0].valveName);
		
    };
    
    gwd.FontRightValveCloseClick = function(event) {
	
		CloseValve(valveArray[0].valveName);
		
    };
    
    gwd.FontLeftValveOpenClick = function(event) 
    {
		OpenValve(valveArray[1].valveName);
    };
    
    gwd.FontLeftValveCloseClick = function(event) 
    {
		CloseValve(valveArray[1].valveName);
    };

    gwd.MiddleRightValveOpenClick = function(event) 
    {
			OpenValve(valveArray[2].valveName);
    };
    
    gwd.MiddleRightValveCloseClick = function(event) 
    {
		CloseValve(valveArray[2].valveName);
    };


    gwd.MiddleLeftValveOpenClick = function(event) 
    {
			OpenValve(valveArray[3].valveName);
    };
    
    gwd.MiddleLeftValveCloseClick = function(event) 
    {
		CloseValve(valveArray[3].valveName);
    };
	
	
    gwd.BackRightValveOpenClick = function(event) 
    {
			OpenValve(valveArray[4].valveName);
    };
    
    gwd.BackRightValveCloseClick = function(event) 
    {
		CloseValve(valveArray[4].valveName);
    };

	
    gwd.BackLeftValveOpenClick = function(event) 
    {
			OpenValve(valveArray[5].valveName);
    };
    
    gwd.BackLeftValveCloseClick = function(event) 
    {
		CloseValve(valveArray[5].valveName);
    };
    
    
    gwd.BackMiddle1ValveOpenClick = function(event) 
    {
			OpenValve(valveArray[6].valveName);
    };
    
    gwd.BackMiddle1ValveCloseClick = function(event) 
    {
		CloseValve(valveArray[6].valveName);
    };
    
  </script>
  
  <script type="text/javascript" gwd-events="registration">
    // Support code for event handling in Google Web Designer
     // This script block is auto-generated. Please do not edit!
    gwd.actions.events.registerEventHandlers = function(event) {
	  gwd.actions.events.addHandler(onOffButtonArray.offImage, 'click', gwd.OffImageClick, false);
	  gwd.actions.events.addHandler(onOffButtonArray.onImage, 'click', gwd.OnImageClick, false);
	  gwd.actions.events.addHandler(onOffButtonArray.autoImage, 'click', gwd.AutoImageClick, false);
      gwd.actions.events.addHandler(valveArray[0].valveImage, 'click', gwd.FontRightValveOpenClick, false);
      gwd.actions.events.addHandler(valveArray[0].waterImage, 'click', gwd.FontRightValveCloseClick, false);
      
      gwd.actions.events.addHandler(valveArray[1].valveImage, 'click', gwd.FontLeftValveOpenClick, false);
      gwd.actions.events.addHandler(valveArray[1].waterImage, 'click', gwd.FontLeftValveCloseClick, false);
      
      gwd.actions.events.addHandler(valveArray[2].valveImage, 'click', gwd.MiddleRightValveOpenClick, false);
      gwd.actions.events.addHandler(valveArray[2].waterImage, 'click', gwd.MiddleRightValveCloseClick, false);
      
      gwd.actions.events.addHandler(valveArray[3].valveImage, 'click', gwd.MiddleLeftValveOpenClick, false);
      gwd.actions.events.addHandler(valveArray[3].waterImage, 'click', gwd.MiddleLeftValveCloseClick, false);
      
      gwd.actions.events.addHandler(valveArray[4].valveImage, 'click', gwd.BackRightValveOpenClick, false);
      gwd.actions.events.addHandler(valveArray[4].waterImage, 'click', gwd.BackRightValveCloseClick, false);
     
      gwd.actions.events.addHandler(valveArray[5].valveImage, 'click', gwd.BackLeftValveOpenClick, false);
      gwd.actions.events.addHandler(valveArray[5].waterImage, 'click', gwd.BackLeftValveCloseClick, false);
     
      gwd.actions.events.addHandler(valveArray[6].valveImage, 'click', gwd.BackMiddle1ValveOpenClick, false);
      gwd.actions.events.addHandler(valveArray[6].waterImage, 'click', gwd.BackMiddle1ValveCloseClick, false);
      
    };
    gwd.actions.events.deregisterEventHandlers = function(event) {
	  gwd.actions.events.removeHandler(onOffButtonArray.offImage, 'click', gwd.OffImageClick, false);
	  gwd.actions.events.removeHandler(onOffButtonArray.onImage, 'click', gwd.OnImageClick, false);
	  gwd.actions.events.removeHandler(onOffButtonArray.autoImage, 'click', gwd.AutoImageClick, false);
	  
      gwd.actions.events.removeHandler(valveArray[0].valveImage, 'click', gwd.FontRightValveOpenClick, false);
      gwd.actions.events.removeHandler(valveArray[0].waterImage, 'click', gwd.FontRightValveCloseClick, false);
      
      gwd.actions.events.removeHandler(valveArray[1].valveImage, 'click', gwd.FontLeftValveOpenClick, false);
      gwd.actions.events.removeHandler(valveArray[1].waterImage, 'click', gwd.FontLeftValveCloseClick, false);
      
      gwd.actions.events.removeHandler(valveArray[2].valveImage, 'click', gwd.MiddleRightValveOpenClick, false);
      gwd.actions.events.removeHandler(valveArray[2].waterImage, 'click', gwd.MiddleRightValveCloseClick, false);
      
      gwd.actions.events.removeHandler(valveArray[3].valveImage, 'click', gwd.MiddleLeftValveOpenClick, false);
      gwd.actions.events.removeHandler(valveArray[3].waterImage, 'click', gwd.MiddleLeftValveCloseClick, false);
      
      gwd.actions.events.removeHandler(valveArray[4].valveImage, 'click', gwd.BackRightValveOpenClick, false);
      gwd.actions.events.removeHandler(valveArray[4].waterImage, 'click', gwd.BackRightValveCloseClick, false);
      
      gwd.actions.events.removeHandler(valveArray[5].valveImage, 'click', gwd.BackLeftValveOpenClick, false);
      gwd.actions.events.removeHandler(valveArray[5].waterImage, 'click', gwd.BackLeftValveCloseClick, false);
      
      gwd.actions.events.removeHandler(valveArray[6].valveImage, 'click', gwd.BackMiddle1ValveOpenClick, false);
      gwd.actions.events.removeHandler(valveArray[6].waterImage, 'click', gwd.BackMiddle1ValveCloseClick, false);
      
    };
    document.addEventListener("DOMContentLoaded", gwd.actions.events.registerEventHandlers);
    document.addEventListener("unload", gwd.actions.events.deregisterEventHandlers);
  </script>
</head>

<body>
  <gwd-doubleclick id="gwd-ad" polite-load="">
    <gwd-metric-configuration></gwd-metric-configuration>
    <div is="gwd-pagedeck" class="gwd-page-container" id="pagedeck">
      <div is="gwd-page" id="page1" class="gwd-page-wrapper gwd-page-size gwd-lightbox" data-gwd-width="728px" data-gwd-height="500px">
        <div class="gwd-page-content gwd-page-size">
          <img is="gwd-image" source="assets/LandNew.jpg" id="land-image" class="gwd-img-j0w7">
          <img is="gwd-image" source="assets/Water_Droplet_Pin.PNG" id="font_right_valve-image" class="gwd-img-mood gwd-img-tqpw gwd-img-1fse">
          <img is="gwd-image" source="assets/Water_Droplet_Pin.PNG" id="font_left_valve-image" class="gwd-img-mood gwd-img-1u3h">
          <img is="gwd-image" source="assets/Water_Droplet_Pin.PNG" id="middle_left_valve-image" class="gwd-img-mood gwd-img-1u3h gwd-img-1q6m">
          <img is="gwd-image" source="assets/Water_Droplet_Pin.PNG" id="back_middle1_valve-image" class="gwd-img-mood gwd-img-1bdg">
          <img is="gwd-image" source="assets/Water_Droplet_Pin.PNG" id="middle_right_valve-image" class="gwd-img-mood gwd-img-1itq">
          <img is="gwd-image" source="assets/Water_Droplet_Pin.PNG" id="back_right_valve-image" class="gwd-img-mood gwd-img-tqpw gwd-img-8f5r">
          <img is="gwd-image" source="assets/Water_Droplet_Pin.PNG" id="back_left_valve-image" class="gwd-img-mood gwd-img-tqpw gwd-img-xdxv">
          <img is="gwd-image" source="assets/watering.gif" id="font_left_water-image" class="gwd-img-u0v9 gwd-img-3yc8">
          <img is="gwd-image" source="assets/watering.gif" id="middle_left_water-image" class="gwd-img-u0v9 gwd-img-1908">
          <img is="gwd-image" source="assets/watering.gif" id="middle_right_water-image" class="gwd-img-u0v9 gwd-img-16s1">
          <img is="gwd-image" source="assets/watering.gif" id="back_middle1_water-image" class="gwd-img-u0v9 gwd-img-162d">
          <img is="gwd-image" source="assets/watering.gif" id="back_right_water-image" class="gwd-img-u0v9 gwd-img-ds25">
          <img is="gwd-image" source="assets/watering.gif" id="back_left_water-image" class="gwd-img-u0v9 gwd-img-91eq">
          <img is="gwd-image" source="assets/watering.gif" id="font_right_water-image" class="gwd-img-u0v9 gwd-img-1m3g">
          <img is="gwd-image" source="assets/OnButton.jpg" id="on_button-image" class="gwd-img-97wm">
          <img is="gwd-image" source="assets/AutoButton.jpg" id="auto_button-image" class="gwd-img-97wm">
          <img is="gwd-image" source="assets/OffButton.jpg" id="off_button-image" class="gwd-img-97wm">
          <span class="gwd-span-srkn" id="Font-Sensor-Text">ชื้น:</span>
        </div>
      </div>
    </div>
  </gwd-doubleclick>
  
  <script type="text/javascript" id="gwd-init-code">
    (function() {
      var gwdAd = document.getElementById('gwd-ad');

      /**
       * Handles the DOMContentLoaded event. The DOMContentLoaded event is
       * fired when the document has been completely loaded and parsed.
       */
      function handleDomContentLoaded(event)
      {
      }

      /**
       * Handles the WebComponentsReady event. This event is fired when all
       * custom elements have been registered and upgraded.
       */
      function handleWebComponentsReady(event) {
        // Start the Ad lifecycle.
        setTimeout(function() {
          gwdAd.initAd();
        }, 0);
      }

      /**
       * Handles the event that is dispatched after the Ad has been
       * initialized and before the default page of the Ad is shown.
       */
      function handleAdInitialized(event) {}

      window.addEventListener('DOMContentLoaded',
        handleDomContentLoaded, false);
      window.addEventListener('WebComponentsReady',
        handleWebComponentsReady, false);
      window.addEventListener('adinitialized',
        handleAdInitialized, false);
    })();
  </script>
</body>

</html>
